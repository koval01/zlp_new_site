const cart_cookie="cart_box",channels=2,backend_host="https://backend.zalupa.world";var timer_notify,payment_url_global,donate_services_array=[],notify_hidden=!0,glob_players=[];function shuffle(e){var a=Math.floor;for(let b,c=e.length;0!==c;)b=a(Math.random()*c),c--,[e[c],e[b]]=[e[b],e[c]];return e}function validateEmail(b){return(b+"").toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)}function request_call(h,a,b,c=!1,d=null){let e=new XMLHttpRequest,f={};e.open(b,a,!0),"POST"===b.toUpperCase()&&(e.setRequestHeader("Content-Type","application/json;charset=UTF-8"),f=JSON.stringify(d)),e.onload=function(){200<=e.status&&400>e.status?c?h(JSON.parse(e.responseText)):h(e.responseText):console.log(`Request status code is ${e.status}`)},e.onerror=function(b){console.log(`Error make request! Details: ${b}`)},e.send(f)}function notify(g){const a=document.querySelector(".error_box_cst"),b=document.querySelector(".error_text_cst"),c=document.querySelector(".btn-scroll-top");let d=function(){a.style.marginBottom="-150px",c.setAttribute("style",""),notify_hidden=!0},e=function(){notify_hidden=!1,b.innerHTML=g,c.style.marginBottom=`calc(${document.getElementById("error_box_cst_id").offsetHeight}px)`,a.style.marginBottom=0};notify_hidden?e():(d(),setTimeout(e,200)),clearTimeout(timer_notify),timer_notify=setTimeout(d,2500)}function url_builder_(d,a){let b=new URL(d);for(let c=0;c<a.length;c++)b.searchParams.set(a[c].name,a[c].value);return b.href}function countProperties(b){return Object.keys(b).length}function getNoun(g,a="\u0438\u0433\u0440\u043E\u043A",b="\u0438\u0433\u0440\u043E\u043A\u0430",c="\u0438\u0433\u0440\u043E\u043A\u043E\u0432"){var d=Math.abs;let e=d(g);return(e%=100,5<=e&&20>=e)?c:(e%=10,1===e)?a:2<=e&&4>=e?b:c}function get_last_tg_post_id(c,a){request_call(function(a){if(a.success)return c(a.last_post)},`${backend_host}/channel?choice=${a}`,"GET",json=!0)}function append_posts(){for(let b=0;b<channels;b++)get_last_tg_post_id(function(d){let a=document.querySelector(".telegram_frames"),b=document.createElement("script");b.src="https://telegram.org/js/telegram-widget.js?19",b.setAttribute("data-telegram-post",d),b.setAttribute("data-width","100%"),b.setAttribute("data-userpic","true"),b.setAttribute("data-dark","1"),a.appendChild(b),setTimeout(function(){let b=document.getElementById("telegram_block_load");try{b.parentNode.removeChild(b)}catch(b){}},100)},b)}function get_game_server_data(c){request_call(function(a){a.success&&c(a.body)},`${backend_host}/server`,"GET",json=!0)}function monitoring_game_server_update(){get_game_server_data(function(b){document.getElementById("server_online_status").innerHTML=`Сейчас играет <span class="text-primary fw-semibold">${b.online}</span> ${getNoun(b.online)}`})}function game_server_updater(){monitoring_game_server_update(),setInterval(monitoring_game_server_update,5e3)}function get_donate_services(c){request_call(function(a){a.success&&c(a.services)},`${backend_host}/donate/services`,"GET",json=!0)}function create_payment(f,a,b,c=null,d=null){request_call(function(a){a.success&&f(a.payment)},`${backend_host}/donate/payment/create`,"POST",json=!0,json_body={customer:a,products:b,email:c,coupon:d})}function append_services(){get_donate_services(function(f){donate_services_array=f;const a=["row-cols-sm-2","row-cols-md-3","row-cols-lg-4"];let b=document.getElementById("donate_items_list");if(!f.length)b.innerHTML="<span class=\"text-center\">\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043F\u043E\u043B\u0443\u0447\u0438\u0442\u044C \u0441\u043F\u0438\u0441\u043E\u043A \u0442\u043E\u0432\u0430\u0440\u043E\u0432.</span>";else for(let c,d=0;d<f.length;d++)c={name:f[d].name,price:f[d].price,count:f[d].number,description:f[d].description,type:f[d].type,service_id:f[d].id},d&&a.length>=d&&b.classList.add(a[d-1]),b.innerHTML+=`
                    <div class="col" id="donate_item_${f[d].id}">
                        <div class="card card-hover border-0 bg-transparent" 
                            onClick='donate_element_click(${JSON.stringify(c)})'>
                          <div class="position-relative">
                            <div class="parent-image-shadow donate_item_hover" 
                                id="donate_item_hover_${f[d].id}">
                                <div class="imageContainer">
                                    <img src="${f[d].image}"
                                     class="rounded-3 foregroundImg" alt="${f[d].name}" 
                                     style="display: block; margin: auto; width: 100px" loading="lazy">
                                    <img src="${f[d].image}"
                                     class="rounded-3 backgroundImg" alt="${f[d].name}" 
                                     style="display: block; margin: auto; width: 100px" loading="lazy">
                                 </div>
                            </div>
                            <div class="card-img-overlay d-flex flex-column align-items-center 
                                        justify-content-center rounded-3" 
                                 style="margin: auto">
                            </div>
                          </div>
                          <div class="card-body text-center p-3">
                                <h3 class="fs-lg fw-semibold pt-1 mb-2">${f[d].name}</h3>
                                <p class="mb-0">
                                    ${f[d].price} 
                                    ${getNoun(f[d].price,"\u0440\u0443\u0431\u043B\u044C","\u0440\u0443\u0431\u043B\u044F","\u0440\u0443\u0431\u043B\u0435\u0439")} 
                                    = 
                                    ${f[d].number} 
                                    ${getNoun(f[d].number,"\u0435\u0434\u0438\u043D\u0438\u0446\u0430","\u0435\u0434\u0438\u043D\u0438\u0446\u044B","\u0435\u0434\u0438\u043D\u0438\u0446")}
                                </p>
                                <p class="fs-sm mb-0">${f[d].description}</p>
                          </div>
                        </div>
                    </div>
                `;setTimeout(function(){let b=document.getElementById("donate_block_load");try{b.parentNode.removeChild(b)}catch(b){}document.getElementById("donate_items_list").style.display="",document.getElementById("donate-title-desc").style.display="",document.getElementById("donate-test-mode-enb").style.display=""},100)})}function redirect_(b){return window.location.replace(b)}function modal_close_(){document.body.classList.remove("modal-open");let b=document.getElementById("donate_item_modal");b.style.opacity=0,setTimeout(function(){b.style.display="none"},350)}function modal_open_(){document.body.classList.add("modal-open");let c=document.getElementById("donate_item_modal");c.style.display="block",setTimeout(function(){c.style.opacity=1},50),window.onclick=function(a){a.target===c&&modal_close_()}}function switch_modal_containers(h="service"){const a=document.getElementsByClassName("close_b")[0],b=document.getElementById("modal-info-container-c"),c=document.getElementById("modal-donate-container-c"),d=document.getElementById("modal-donate-finish-container-c"),e=document.querySelector(".modal-title"),f=[{name:"service",selector:c,title:"\u0422\u043E\u0432\u0430\u0440"},{name:"info",selector:b,title:"\u0421\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435"},{name:"donate_finish",selector:d,title:"\u041A\u043E\u0440\u0437\u0438\u043D\u0430"}];for(let a,b=0;b<f.length;b++)a="none",h===f[b].name&&(a="block",e.innerText=f[b].title),f[b].selector.style.display=a;a.onclick=function(){modal_close_()}}function get_cookie_cart(){let b={};try{b=JSON.parse(Cookies.get(cart_cookie))}catch(b){}return b}function update_cart_count(){document.getElementById("count_cart_items_dn").innerText=countProperties(get_cookie_cart())}function group_already_in_cart(c){let a=Object.keys(c);for(let b=0;b<donate_services_array.length;b++)if("group"===donate_services_array[b].type&&a.includes(donate_services_array[b].id.toString()))return!0;return!1}function comments_init(){new Swiper("#comment_swipe_container",{spaceBetween:12,loop:!0,observer:!0,observeParents:!0,pagination:{el:".swiper-pagination-comments",clickable:!0},navigation:{prevEl:"#prev_comment",nextEl:"#next_comment"}})}function build_players_swiper(){let c=document.getElementById("players-swiper-array");const a=function(){new Swiper("#players_swipe_container",{slidesPerView:2,spaceBetween:24,autoplay:{delay:3e3},loop:!0,observer:!0,observeParents:!0,pagination:{el:".swiper-pagination-players",clickable:!0},breakpoints:{500:{slidesPerView:3},650:{slidesPerView:4},900:{slidesPerView:5},1100:{slidesPerView:6}}})};request_call(function(b){let e=b;shuffle(e);for(let a=0;a<e.length;a++)glob_players.push(e[a].name),c.innerHTML+=`
                <div class="swiper-slide">
                    <span class="d-block py-3">
                        <img src="${e[a].head}" class="d-block mx-auto" width="154"
                           alt="${e[a].name}" loading="lazy"
                        <div class="card-body text-center p-3">
                            <h3 class="fs-lg fw-semibold pt-1 mb-2">${e[a].name}</h3>
                            <p class="fs-sm mb-0">${e[a].desc}</p>
                        </div>
                    </span>
                </div>
            `;a()},"assets/data/players.json","GET",json=!0)}function donate_element_click(p){var a=Math.sign;switch_modal_containers("service");const b=["group"];let q=document.getElementById("donate_item_select_text"),d=`Товар <span class="text-primary fw-semibold">${p.name}</span>, 
        цена ${p.count} ${getNoun(p.count,"\u0435\u0434\u0438\u043D\u0438\u0446\u044B","\u0435\u0434\u0438\u043D\u0438\u0446","\u0435\u0434\u0438\u043D\u0438\u0446")} 
        <span class="text-primary fw-semibold">${p.price} 
        ${getNoun(p.price,"\u0440\u0443\u0431\u043B\u044C","\u0440\u0443\u0431\u043B\u044F","\u0440\u0443\u0431\u043B\u0435\u0439")}</span>.`,e=document.getElementById("items_count_donate"),c=document.getElementById("donate_count_text_hint"),f=document.getElementById("donate_button_add_to_cart");const g=get_cookie_cart();let h=!1,i=function(){f.setAttribute("onClick",`donate_cart(${p.service_id}, ${e.value})`)};e.value=1,i();const k=g.hasOwnProperty(p.service_id.toString());if((b.includes(p.type)||"group"===p.type)&&group_already_in_cart(g)){switch_modal_containers("info"),h=!0;let a="";a="group"===p.type?"\u0412\u044B \u0443\u0436\u0435 \u0432\u044B\u0431\u0440\u0430\u043B\u0438 \u043F\u0440\u0438\u0432\u0438\u043B\u0435\u0433\u0438\u044E. \u0423\u0434\u0430\u043B\u0438\u0442\u0435 \u0435\u0451 \u0438\u0437 \u043A\u043E\u0440\u0437\u0438\u043D\u044B, \u0435\u0441\u043B\u0438 \u0445\u043E\u0442\u0438\u0442\u0435 \u0432\u044B\u0431\u0440\u0430\u0442\u044C \u0434\u0440\u0443\u0433\u0443\u044E.":k?`Ошибка, вы можете добавить товар 
            <span class="text-primary fw-semibold">${p.name}</span> 
            только один раз.`:"\u041C\u044B \u043D\u0435 \u0437\u043D\u0430\u0435\u043C \u043F\u043E\u0447\u0435\u043C\u0443, \u043D\u043E \u044D\u0442\u0430 \u043E\u0448\u0438\u0431\u043A\u0430 \u0432\u044B\u0437\u0432\u0430\u043D\u0430 \u043F\u043E \u043D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u043C \u043F\u0440\u0438\u0447\u0438\u043D\u0430\u043C.",document.getElementById("donate_info_block_text").innerHTML=a}let l="block";b.includes(p.type)&&(l="none"),e.style.display=l,c.style.display=l;const r=function(){let b=e.value;e.value=b.replace(/\D+/g,"")},n=function(){if(r(),!b.includes(p.type)){let b=parseInt(e.value)*p.price;(isNaN(b)||1>a(b))&&(b=0),q.innerHTML=`${d}<br/>Стоимость - 
            <span class="text-primary fw-semibold">${b} 
            ${getNoun(b,"\u0440\u0443\u0431\u043B\u044C","\u0440\u0443\u0431\u043B\u044F","\u0440\u0443\u0431\u043B\u0435\u0439")}</span>`,i()}};q.innerHTML=d,n(),e.addEventListener("input",function(){n()}),modal_open_()}function donate_get_service_by_id(c){for(let a=0;a<donate_services_array.length;a++)if(donate_services_array[a].id===parseInt(c))return donate_services_array[a];return null}function donate_cart(i,a,b=!1){var c=Number.isInteger,d=Math.sign;if(!c(i)||!c(a))return void console.log("Error data donate_cart");if(1>d(a))return void notify("\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u043D\u0435 \u043C\u043E\u0436\u0435\u0442 \u0431\u044B\u0442\u044C \u0440\u0430\u0432\u043D\u043E \u043D\u0443\u043B\u044E \u0438\u043B\u0438 \u043C\u0435\u043D\u044C\u0448\u0435");let e=Cookies.get(cart_cookie);e||Cookies.set(cart_cookie,JSON.stringify({}));const f=JSON.parse(Cookies.get(cart_cookie)),g=donate_get_service_by_id(i);b?(delete f[i],notify(`Товар ${"<span style=\"color: #a4a6ff !important\">"} ${g.name}</span> убран из корзины`)):f[i]?(f[i]+=a,notify(`В корзину добавлено ${"<span style=\"color: #a4a6ff !important\">"} ${a} </span> 
                        ${getNoun(a,"\u0435\u0434\u0438\u043D\u0438\u0446\u0430","\u0435\u0434\u0438\u043D\u0438\u0446\u044B","\u0435\u0434\u0438\u043D\u0438\u0446")} 
                        товара ${"<span style=\"color: #a4a6ff !important\">"} ${g.name} </span>`)):(f[i]=a,notify(`Товар ${"<span style=\"color: #a4a6ff !important\">"} ${g.name}</span> добавлен в корзину`)),Cookies.set(cart_cookie,JSON.stringify(f)),modal_close_(),donate_init(),update_cart_count()}function donate_cart_button(e={}){const a=document.querySelectorAll(".donate-cart-button-cn");for(let b,c=0;c<a.length;c++)b=a[c].style,countProperties(e)?(b.opacity=1,b.marginTop="15px"):(b.opacity=0,b.marginTop="-50px")}function donate_flush_cart(){Cookies.remove(cart_cookie),donate_cart_button({}),notify("\u041A\u043E\u0440\u0437\u0438\u043D\u0430 \u043E\u0447\u0438\u0449\u0435\u043D\u0430")}function donate_enable_coupon(d=!0){const a=document.getElementById("coupon-input"),b=document.getElementById("coupon-button");d?(a.setAttribute("placeholder","BRFF"),a.removeAttribute("disabled"),b.removeAttribute("disabled")):(a.setAttribute("disabled",null),a.setAttribute("placeholder","\u0421\u0435\u0439\u0447\u0430\u0441 \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u043D\u043E"),b.setAttribute("disabled",null))}function generate_payment_link(){const e=document.getElementById("payment-button-donate"),a=document.getElementById("donate_customer").value.trim();let b=document.getElementById("donate_email").value.trim(),f=document.getElementById("coupon-input").value.trim();if(!a.length)return void notify("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430 \u0432\u0430\u0448 \u043D\u0438\u043A\u043D\u0435\u0439\u043C");if(40<a.length)return void notify("\u0412\u0430\u0448 \u043D\u0438\u043A\u043D\u0435\u0439\u043C \u0441\u043B\u0438\u0448\u043A\u043E\u043C \u0434\u043B\u0438\u043D\u043D\u044B\u0439");if(a.match(/[A-z\d_\S]/i)||notify("\u041D\u0438\u043A\u043D\u0435\u0439\u043C \u043D\u0435 \u0441\u043E\u043E\u0442\u0432\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0444\u043E\u0440\u043C\u0430\u0442\u0443"),!b.length)b=null;else if(!validateEmail(b))return void notify("\u041E\u0448\u0438\u0431\u043A\u0430, \u0430\u0434\u0440\u0435\u0441 \u043F\u043E\u0447\u0442\u044B \u043D\u0435\u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043B\u044C\u043D\u044B\u0439");f||(f=null),e.setAttribute("disabled",null),e.innerText="\u041F\u0440\u043E\u0432\u0435\u0440\u044F\u0435\u043C \u0434\u0430\u043D\u043D\u044B\u0435...",create_payment(function(a){a?(e.removeAttribute("disabled"),e.innerText="\u041E\u043F\u043B\u0430\u0442\u0438\u0442\u044C",payment_url_global=a.url,e.setAttribute("onClick","payment_action_bt()")):e.innerText="\u041E\u0448\u0438\u0431\u043A\u0430..."},a,get_cookie_cart(),b,f)}function payment_action_bt(){window.open(payment_url_global,"_blank")}function donate_check_services_cart(){const e=Object.keys(get_cookie_cart());get_donate_services(function(d){let b=[];for(let c=0;c<d.length;c++)b.push(d[c].id);for(let a=0;a<e.length;a++)if(!b.includes(parseInt(e[a]))){let c=JSON.parse(Cookies.get(cart_cookie));delete c[parseInt(e[a])],Cookies.set(cart_cookie,JSON.stringify(c)),console.log(`Remove ${e[a]} from cart`)}})}function donate_init(){let b={};try{b=JSON.parse(Cookies.get(cart_cookie))}catch(b){}donate_cart_button(b),donate_check_services_cart(),donate_enable_coupon(enabled=!1)}function donate_reset_payment_state(){const b=document.getElementById("payment-button-donate");b.setAttribute("onClick","generate_payment_link()"),b.innerText="\u0414\u0430\u043B\u044C\u0448\u0435"}function donate_cart_call(g=null){const h=get_cookie_cart(),b=Object.keys(h),c=document.getElementById("donate-cart-list"),a=[document.getElementById("donate_customer"),document.getElementById("donate_email"),document.getElementById("coupon-input")];switch_modal_containers("donate_finish"),modal_open_(),c.innerHTML="";let d=0;for(let c=0;c<a.length;c++)a[c].addEventListener("input",function(){donate_reset_payment_state()});for(let f=0;f<b.length;f++){let e=donate_get_service_by_id(b[f]),a=e.price*h[e.id];d+=a,c.innerHTML+=`
            <li class="list-group-item d-flex justify-content-between lh-sm">
                <div>
                    <h6 class="my-0 text-start">
                        <span class="text-primary fw-semibold">
                            x${e.number}</span> 
                        ${e.name}
                    </h6>
                    <small class="text-muted text-start cart-desc-td">${e.description}</small>
                </div>
                <span class="text-muted text-end" style="width: 30%">
                    ${a} ${getNoun(a,"\u0440\u0443\u0431\u043B\u044C","\u0440\u0443\u0431\u043B\u044F","\u0440\u0443\u0431\u043B\u0435\u0439")}
                    <br/>x${h[e.id]}</span>
            </li>
        `}g&&(c.innerHTML+=`
            <li class="list-group-item d-flex justify-content-between bg-light">
                <div class="text-success">
                    <h6 class="my-0 text-start">Купон</h6>
                    <small>${g}</small>
                </div>
                <span class="text-success">−0 рублей</span>
            </li>
        `),c.innerHTML+=`
        <li class="list-group-item d-flex justify-content-between">
            <span>Сумма</span>
            <strong>${d} ${getNoun(d,"\u0440\u0443\u0431\u043B\u044C","\u0440\u0443\u0431\u043B\u044F","\u0440\u0443\u0431\u043B\u0435\u0439")}</strong>
        </li>
    `,shuffle(glob_players),document.querySelector("input#donate_customer").setAttribute("placeholder",glob_players[0])}function landing_init(){["localhost","zalupa.world"].includes(window.location.hostname)&&(document.getElementById("landing_description_gb").innerText="\u042D\u0442\u043E\u0442 \u0441\u0430\u0439\u0442 - development-\u0432\u0435\u0440\u0441\u0438\u044F!",document.getElementById("donate-test-mode-enb").innerText="\u042D\u0442\u043E\u0442 \u0431\u043B\u043E\u043A \u0440\u0430\u0431\u043E\u0442\u0430\u0435\u0442 \u0432 \u0434\u0435\u043C\u043E\u043D\u0441\u0442\u0440\u0430\u0442\u0438\u0432\u043D\u043E\u043C \u0440\u0435\u0436\u0438\u043C\u0435 \u0438 \u043D\u0435 \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u0444\u0443\u043D\u043A\u0446\u0438\u043E\u043D\u0430\u043B\u044C\u043D\u044B\u043C.")}function finish_load(){document.querySelector("main").setAttribute("style",""),document.querySelector("footer").setAttribute("style","")}document.addEventListener("DOMContentLoaded",function(){landing_init(),build_players_swiper(),append_posts(),comments_init(),append_services(),update_cart_count(),game_server_updater(),donate_init(),finish_load();let b=document.getElementById("dark-perm-set-bv");b.parentNode.removeChild(b),window.matchMedia("(prefers-color-scheme: dark)").addListener()});